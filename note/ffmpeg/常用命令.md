# FFmpeg 常用命令



### 时间调整

#### 拆分视频

首尾会自动寻找关键帧

-ss 开始时间 -t 持续时间

```bash
ffmpeg -ss 02:00:40 -t 0:01:44 -accurate_seek -i input.mp4 -codec copy -avoid_negative_ts 1 output.mp4
```
更多精确拆分的解释：<https://blog.csdn.net/matrix_laboratory/article/details/53157383>

#### 精确时间拆分视频

-ss 开始时间 -t 持续时间

```bash
ffmpeg -ss 0:0:2 -t 0:0:10 -accurate_seek -i input.mp4 -codec copy output.mp4
```



### 字幕相关

#### SRT字幕转ASS字幕
```bash
ffmpeg -i input.srt output.ass
```

#### 压制ass字幕

```bash
ffmpeg -i input.mp4 -vcodec libx264 -preset medium -crf 23 -vf "ass=input.ass" output.mp4
```

如果要由高分辨率低压缩的话用下面这句代码，其中Scale值：1080P对应1920，720P对应1280。

```bash
ffmpeg -i output.mp4 -vcodec libx264 -preset fast -crf 23 -vf "ass=input.ass,scale=1920:-1" output.mp4
```

##### 参数说明

`preset` - 编码速度，可选参数值如下：

`ultrafast` `superfast` `veryfast` `faster` `fast` `medium` `slow` `slower` `veryslow` `placebo`
默认值为`medium`，编码速度越慢文件大小会越小

`CFR` - 固定帧率 (constant rate factor)
无损：`0`、缺省值：`23`、最差：`51`、 一般选`18~28` 往往选`18`接近无损



### 格式转换

#### 转换mkv至mp4

```bash
ffmpeg -i jr.mkv -y -vcodec copy -acodec copy jr.mp4
```
#### 转换webm至mp3

```bash
ffmpeg -i videoplayback.webm -acodec libmp3lame -aq 4 output.mp3
```
#### 无损转换flv至mp4

```bash
ffmpeg -i input.flv output.mp4
```



### 混缩与提取

#### 合并音频和视频

```bash
ffmpeg -i videoplayback.mp4 -i videoplayback.webm -c:v copy output.mp4
```
#### 提取音频文件

```bash
ffmpeg -i input.mp4 -vn -ab 256k outputaudio.m4a
```
#### 提取视频文件

```bash
ffmpeg -i input.mp4 -an output.mp4
```



### 串流相关

#### 将rtmp流保存为视频

```bash
ffmpeg -i "rtmp://192.168.10.103:1935/live/111 live=1" -acodec copy -vcodec copy -f flv -y test.flv
```





### 参考链接

- ffmpeg linux 命令 在线中文手册：<http://linux.51yip.com/search/ffmpeg>